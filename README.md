# Сервис коротких ссылок

## Описание сервиса 

Сервис коротких ссылок — это инструмент, который позволяет пользователям сокращать длинные URL, получая уникальные короткие ссылки и управлять их параметрами. 
<br><br>
Пользователи могут устанавливать лимит на количество переходов по коротким ссылкам и отслеживать активность по каждой из них. 
После достижения лимита переходов или истечения установленного срока короткая ссылка становится недоступной для последующего использования.
Дополнительно сервис отслеживает непригодные (достигнут лимит переходов или достигнуто время использования) короткие ссылки и удаляет их с установленной периодичностью.
---


## Требования к программному обеспечению 

Для корректной работы и тестирования сервиса необходимо наличие следующего установленного
и настроенного программного обеспечения:

* Docker;
* Gradle;
* OpenJDK 17+;
* Программа командной строки ***curl*** или ПО Postman для тестирования API;
* Среда разработки IntelliJ IDEA (Community или Ultimate);
* Система контроля версий Git;
---


## Запуск необходимой инфраструктуры 

1. Первоначально необходимо склонировать репозиторий сервиса с помощью команды:
```bash
git clone https://github.com/euchekavelo/short-link-service.git
```
2. Затем перейти в корневую директорию проекта и запустить docker-контейнер с БД PostgreSQL командой:
```bash
docker-compose up -d
```
3. Открыть и запустить склонированный проект, используя IntelliJ IDEA.
---


## Инструкция по использованию 

Сервис представляет из себя бэкенд-приложения, функциональность которого заключается в использовании REST API, отвечающего за ключевые операции, а также метода, который работает по заданному расписанию с определенной периодичностью.
<br>Ниже представлены некоторые примеры таких операций с использованием программы командной строки ***curl***.
---
### Создать короткую ссылку для нового пользователя
Пример команды:
```bash
curl --location --request POST 'http://localhost:8080/short-links' \
--header 'Content-Type: application/json' \
--data '{
    "link": "ya.ru",
    "expirationIntervalSeconds": "",
    "hopLimit": ""
}'
```
**Важно:** 
<br>
При неуказанных свойствах ***expirationIntervalSeconds*** и ***hopLimit*** (прямо как в примере) для новой короткой ссылки будут установлены соответствующие значения продолжительности жизни в секундах и лимита, опеределенные в файле ***application.yml***.
<br>Если значения свойств ***expirationIntervalSeconds*** или ***hopLimit*** указаны в запросе:
* Итоговое значение продолжительности жизни короткой ссылки определяется между минимальным значением среди ***expirationIntervalSeconds*** из запроса и ***expirationIntervalSeconds*** из конфигурационного файла;
* Итоговое значение лимита переходов для короткой ссылки определяется между максимальным значением среди ***hopLimit*** из запроса и ***hopLimit*** из конфигруационного файла.
---

### Выполнить переход по короткой ссылке
Пример команды:
```bash
curl --location --request POST 'http://localhost:8080/short-links/transition' \
--header 'Content-Type: application/json' \
--data '{
    "userId": "9a8463fa-7f15-438a-9d5c-b629cab224e4",
    "shortLink": "clck.ru/1735953965738f95"
}'
```
**Важно:** 
<br>
Данный эндпоинт возвращает ошибку, если указанная короткая ссылка отсутствует или не соответствует условиям для перехода (дистигнут лимит или превышено время жизни).
---

### Создать/пересоздать короткую ссылку для существующего пользователя
Пример команды:
```bash
curl --location --request POST 'http://localhost:8080/users/e15ef6de-e987-43b5-82e4-089735624fd6/short-links' \
--header 'Content-Type: application/json' \
--data '{
    "link": "ya.ru",
    "expirationIntervalSeconds": "",
    "hopLimit": ""
}'
```
**Важно:** 
<br>
1) Данный эндпоинт возвращается ошибку, если пользователь с данным идентификатором не найден.
2) При неуказанных свойствах ***expirationIntervalSeconds*** и ***hopLimit*** (прямо как в примере) для новой короткой ссылки будут установлены соответствующие значения продолжительности жизни в секундах и лимита, опеределенные в файле ***application.yml***.
<br>Если значения свойств ***expirationIntervalSeconds*** или ***hopLimit*** указаны в запросе:
   * Итоговое значение продолжительности жизни короткой ссылки определяется между минимальным значением среди ***expirationIntervalSeconds*** из запроса и ***expirationIntervalSeconds*** из конфигурационного файла;
   * Итоговое значение лимита переходов для короткой ссылки определяется между максимальным значением среди ***hopLimit*** из запроса и ***hopLimit*** из конфигруационного файла.
---

### Изменить лимит переходов по короткой ссылке для пользователя
Пример команды:
```bash
curl --location --request PUT 'http://localhost:8080/users/c906d711-9eff-48ca-ba59-c443ff947fbb/short-links' \
--header 'Content-Type: application/json' \
--data '{
    "hopLimit": 4,
    "shortLink": "clck.ru/1735955395049143"
}'
```
**Важно:**
<br>
Данный эндпоинт возвращается ошибки, если короткую ссылку для пользователя найти не удалось, а также если было передано некорректное значение для лимита, которое меньше или равное установленному значению из конфигурационного файла. 
---

### Удалить короткую ссылку пользователя
Пример команды:
```bash
curl --location --request DELETE 'http://localhost:8080/users/e15ef6de-e987-43b5-82e4-089735624fd6/short-links' \
--header 'Content-Type: application/json' \
--data '{
    "shortLink": "clck.ru/1735956898742783"
}'
```
**Важно:** 
<br>
Данный эндпоинт возвращает ошибку, если короткую ссылку по переданным параметрам найти не удалось. 
---

### Автоматическое удаление неактуальных коротких ссылок
Также в сервисе предусмотрена работа метода для удкаления коротких ссылок, по которым был достигнут лимит или истекло время жизни.
<br>
Данный метод запускается **каждую минуту в 00 секунд** в соответствии с ***cron-шаблоном***, заданным в конфигурационном файле.

---